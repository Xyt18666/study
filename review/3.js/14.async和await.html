<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body></body>
  <script>
    /*
        async/await是对Promise的优化： 
            async/await是基于Promise的，是进一步的一种优化，不过在写代码时，Promise本身的API出现得很少，很接近同步代码的写法.



        async关键字:

            1.表明程序里面可能有异步过程

            2.非阻塞： async函数里面如果有异步过程会等待，但是async函数本身会马上返回，不会阻塞当前线程，可以简单认为，async函数工作在主线程，同步执行，不会阻塞界面渲染，async函数内部由await关键字修饰的异步过程，工作在相应的协程上，会阻塞等待异步任务的完成再返回；

            3.async函数返回类型为Promise对象： 
                这是和普通函数本质上不同的地方，也是使用时重点注意的地方；
                （1）return newPromise();这个符合async函数本意；
                （2）return data;这个是同步函数的写法，这里是要特别注意的，这个时候，其实就相当于Promise.resolve(data);还是一个Promise对象，但是在调用async函数的地方通过简单的=是拿不到这个data的，因为返回值是一个Promise对象，所以需要用.then(data => { })函数才可以拿到这个data；
                （3）如果没有返回值，相当于返回了Promise.resolve(undefined);

            4.无等待:
                联想到Promise的特点，在没有await的情况下执行async函数，它会立即执行，返回一个Promise对象，并且绝对不会阻塞后面的语句，这和普通返回Promise对象的函数并无二致；

            5.await不处理异步error： 
                await是不管异步过程的reject(error)消息的，async函数返回的这个Promise对象的catch函数负责统一抓取内部所有异步过程的错误；async函数内部只要有一个异步过程发生错误，整个执行过程就中断，这个返回的Promise对象的catch就能抓取到这个错误；

            6.async函数的执行：
                async函数执行和普通函数一样，函数名带个()就可以了，参数个数随意，没有限制，也需要有async关键字；只是返回值是一个Promise对象，可以用then函数得到返回值，用catch抓整个流程中发生的错误；


        await关键字:

            1.await只能在async函数内部使用：不能放在普通函数里面，否则会报错；

            2.await关键字后面跟Promise对象：
                在Pending状态时，相应的协程会交出控制权，进入等待状态，这是协程的本质；

            3.await是async wait的意思： 
                wait的是resolve(data)的消息，并把数据data返回，比如下面代码示 例一 中，当Promise对象由Pending变为Resolved的时候，变量a就等于data，然后再顺序执行下面的语句console.log(a)，这真的是等待，真的是顺序执行，表现和同步代码几乎一模一样；

            4.await后面也可以跟同步代码： 
                不过系统会自动将其转化成一个Promsie对象，比如 示例二

            5.await对于失败消息的处理：
                await只关心异步过程成功的消息resolve(data)，拿到相应的数据data，至于失败消息reject(error)，不关心不处理；对于错误的处理有以下几种方法供选择：
                    （1）让await后面的Promise对象自己catch；
                    （2）也可以让外面的async函数返回的Promise对象统一catch；
                    （3）像同步代码一样，放在一个try...catch结构中；


            6.await对于结果的处理： 
                await是个运算符，用于组成表达式，await表达式的运算结果取决于它等的东西，如果它等到的不是一个Promise对象，那么await表达式的运算结果就是它等到的东西；如果它等到的是一个Promise对象，await就忙起来了，它会阻塞其后面的代码，等着Promise对象resolve，然后得到resolve的值，作为await表达式的运算结果；虽然是阻塞，但async函数调用并不会造成阻塞，它内部所有的阻塞都被封装在一个Promise对象中异步执行，这也正是await必须用在async函数中的原因；








*/
    {
      function 摇色子() {
        return new Promise((resolve, reject) => {
          let sino = parseInt(Math.random() * 6 + 1);
          setTimeout(() => {
            resolve(sino);
          }, 3000);
        });
      }
      async function test() {
        let n = await 摇色子();
        console.log(n);
      }
      test();
    }
    {
      // 示例一
      //   const a = await new Promise((resolve, reject) => {
      //     // async process ...
      //     return resolve(data);
      //   });
      //   console.log(a);
    }
    {
      // 示例二
      //   const a = await "hello world";
      //   // 相当于
      //   const a = await Promise.resolve("hello world");
      //   // 跟同步代码是一样的，还不如省事点，直接去掉await关键字
      //   const a = "hello world";
    }
  </script>
</html>
